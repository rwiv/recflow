global:
  name: recflow
  namespace: media

image:
  repository: harbor.rwiv.xyz/private/recflow
  tag: 2.5.7
  pullSecret: image-pull-secret

affinity: ~
tolerations: ~
podLabels: ~

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  host: ~
  secretName: cloudflare-certificate

resources:
  requests:
    memory: 300Mi
  limits:
    memory: 500Mi

app:
  replicas: 2
  fsName: ~
  redis:
    host: recflow-redis-master.media.svc.cluster.local
    port: 6379
    secrets:
      auth:
        name: recflow-redis-auth
        passwordKey: password
  postgres:
    host: recflow-postgresql.media.svc.cluster.local
    port: 5432
    database: recflow
    secretName: recflow-postgresql
    usernameKey: username
    passwordKey: password
  configs:
    httpTimeoutMs: 20000
    liveAllocationInitWaitSec: 15
    liveRecoveryInitWaitSec: 120 # 2 minutes
    liveFinishTimeoutSec: 180 # 3 minutes
    nodeResetCycleSec: 43200 # 12 hours
    nodeFailureThreshold: 50
    liveStateInitWaitSec: 120 # 2 minutes
    liveStateExpireSec: 604800 # 7 days
    recnodeClearBatchSize: 50
    cacheExpireSec: 86400 # 24 hours
    maxConcurrentLive: 3

externals:
  recnode:
    locations:
      default: local
      followed: local
    auth:
      secretName: recnode-auth
      tokenKey: bearer-token
    redis:
      isInternal: false
      internal:
        masterHost: recnode-redis-master.media.svc.cluster.local
        masterPort: 6379
        replicaHost: recnode-redis-replicas.media.svc.cluster.local
        replicaPort: 6379
      external:
        secretName: recnode-redis-client
        hostKey: host
        masterPortKey: master-port
        replicaPortKey: replica-port
      server:
        secretName: recnode-redis-server
        passwordKey: password
    queue:
      secretName: recnode-queue
      regionNameKey: region-name
      queueUrlKey: queue-url
  streamq:
    url: http://streamq.media.svc.cluster.local
    qsize: 200
  stlink:
    endpoint: http://stlink-domestic.media.svc.cluster.local
    endpointDomestic: http://stlink-domestic.media.svc.cluster.local
    endpointOverseas: http://stlink-overseas.media.svc.cluster.local
    httpTimeoutMs: 30000
    enforceAuthForFollowed: true
  untf:
    endpoint: http://untf.common.svc.cluster.local
    secretName: untf-client
    apiKeySecretKey: api-key
    topic: stmgr
  sqs:
    secretName: sqs-auth
    accessKeyKey: access-key
    secretKeyKey: secret-key
