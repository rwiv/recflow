global:
  name: stmgr
  namespace: media

image:
  repository: harbor.rwiv.xyz/private/stmgr
  tag: 1.5.8
  pullSecret: image-pull-secret

affinity: ~
tolerations: ~
podLabels:
  sidecar.istio.io/inject: "true"

vault:
  mount: kube
  path: media/stmgr/config
  version: 1
  secretName: stmgr-config
  refreshAfter: 30s
  keys:
    fsName: fs-name

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  gateway: istio-system/external-gateway
  hostName: stmgr.rwiv.xyz

app:
  server:
    endpoint: http://stmgr:80
  redis:
    host: stmgr-redis-master.media.svc.cluster.local
    port: 6379
    secrets:
      auth:
        name: stmgr-redis-auth
        passwordKey: password
  postgres:
    host: stmgr-postgresql.media.svc.cluster.local
    port: 5432
    database: stmgr
    secretName: stmgr-postgresql
    usernameKey: username
    passwordKey: password
  configs:
    httpTimeoutMs: 5000
    liveAllocationInitWaitSec: 15
    liveRecoveryInitWaitSec: 40
    liveFinishTimeoutSec: 180 # 3 minutes
    nodeResetCycleSec: 43200 # 12 hours
    nodeFailureThreshold: 10
    liveStateInitWaitSec: 120 # 2 minutes
    liveStateExpireSec: 604800 # 7 days
    stdlClearBatchSize: 50
    cacheExpireSec: 86400 # 24 hours
    maxConcurrentLive: 3

externals:
  stdl:
    redis:
      masterHost: stdl-redis.rwiv.xyz
      masterPort: 30211
      replicaHost: stdl-redis.rwiv.xyz
      replicaPort: 30212
      secrets:
        auth:
          name: stdl-redis-auth
          passwordKey: password
        tls:
          name: stdl-redis-tls
          caKey: ca.crt
  streamq:
    url: http://streamq-vpn.media.svc.cluster.local
    qsize: 200
  stlink:
    endpoint: http://stlink.media.svc.cluster.local
  authed:
    url: http://authed.common.svc.cluster.local
    secretName: authed-app
    apiKeySecretKey: api-key
  untf:
    endpoint: http://untf.common.svc.cluster.local
    secretName: untf-client
    apiKeySecretKey: api-key
    topic: stmgr
  vtask:
    endpoint: http://vtask-server.media.svc.cluster.local
